---
title: "Exploring States of Tobacco-Use with Sankey Plots"
author: "R package build"
date: '2021-05-20'
slug: exploring-states-of-tobacco-use-with-sankey-plots
categories:
- data-analysis
- data-visualization
tags: []
description: ''
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>
<script src="{{< blogdown/postref >}}index_files/htmlwidgets/htmlwidgets.js"></script>
<script src="{{< blogdown/postref >}}index_files/pymjs/pym.v1.js"></script>
<script src="{{< blogdown/postref >}}index_files/widgetframe-binding/widgetframe.js"></script>


<style type="text/css">
img {
    display: block;
  margin-left: auto;
  margin-right: auto;
  
}
</style>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>While working toward my master’s degree in applied statistics, I interned at the <a href="https://publichealth.nyu.edu/research-scholarship/centers-labs-initiatives/tobacco-research-lab">Tobacco Research Lab</a> at NYU’s College of Global Public Health. During my internship, I collaborated with another researcher to study changing smoking states over time. We were interested in answering questions such as what proportion of cigarette smokers quit and what proportion of former smokers relapse.</p>
<p>We began our project by focusing on descriptive statistics and data visualization. To represent changes in smoking behavior over time, we used a data visualization technique called a Sankey diagram. I will be mainly focusing on Sankey diagrams in this post; however, I will also cover some background on the Population Assessment of Tobacco and Health (PATH) study.</p>
</div>
<div id="required-r-skills" class="section level1">
<h1>Required R Skills</h1>
<p>Preparing the data required some data manipulation. I used some basic tidyverse functions to accomplish this. You can find many online tutorials on R and the collection of packages in the tidyverse.</p>
</div>
<div id="about-the-path-study-and-data" class="section level1">
<h1>About the PATH Study and Data</h1>
<p>The <a href="https://pathstudyinfo.nih.gov/">PATH study</a> is a longitudinal study of tobacco use and attitudes funded by the National Institute of Health (NIH) and the Food and Drug Administation (FDA).The study began in 2013 and has aimed to follow the same respondents across multiple waves. The fourth and most recent wave ended in January of 2018. According to the <a href="https://www.fda.gov/tobacco-products/research/fda-and-nih-study-population-assessment-tobacco-and-health">FDA’s website</a>, one of its goals of is to “study patterns of tobacco product use, cessation, and relapse”, which aligned well with the focus of my internship.</p>
</div>
<div id="states-of-tobacco-use" class="section level1">
<h1>States of Tobacco Use</h1>
<p>The PATH survey offers a number of ways to classify smokers. For my internship, we focused on five states of cigarette smoking/cessation.</p>
<div id="smoking-behavior-classifications" class="section level4">
<h4>Smoking Behavior Classifications</h4>
<ol style="list-style-type: decimal">
<li>Current Established Smoker</li>
<li>Former Established Smoker</li>
<li>Current Experimental Smoker</li>
<li>Former Experimental Smoker</li>
<li>Non Smoker</li>
</ol>
<p>The non-smoker category is self-explanatory, but the other ones may require some explanation.</p>
<p><strong>Established vs. Experimental Smokers</strong>
Established smokers were classified as respondents who reported to have smoked at least 100 cigarettes in their lifetime. Experimental smokers were those who reported smoking between 1 and 99 cigarettes in their lifetime.</p>
<p><strong>Current vs. Former</strong>
Current smokers were those who reported currently smoking everyday or some days. Former smokers were those who had reported smoking at least one cigarette in their lifetime but not smoking currently.</p>
</div>
</div>
<div id="our-goal" class="section level1">
<h1>Our Goal</h1>
<p>Our first goal was to create a Sankey Diagram to visualize these transitions across the three waves of data that were available at the time my internship.</p>
</div>
<div id="a-brief-history-of-sankey-diagrams" class="section level1">
<h1>A Brief History of Sankey Diagrams</h1>
<p><a href="https://en.wikipedia.org/wiki/Sankey_diagram#:~:text=Sankey%20diagrams%20are%20a%20type,proportional%20to%20the%20flow%20rate.&amp;text=Sankey%20diagrams%20emphasize%20the%20major,quantities%20within%20defined%20system%20boundaries">Sankey diagrams</a> are a type of flow chart to model transitions over time. In a Sankey diagram, the proportions of each flow are represented through the width of the arrows.</p>
<p>Sankey diagrams are named after Captain Matthew Henry Phineas Riall Sankey, <a href="https://en.wikipedia.org/wiki/Sankey_diagram" class="uri">https://en.wikipedia.org/wiki/Sankey_diagram</a>, an Irish engineer, who created a diagram of the flow of steam through an engine in 1898. Below is the Steam Engine diagram he created.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-3"></span>
<img src="/img/steam_engine_sankey.png" alt="Original Sankey Diagram (Source: Wikipedia)" width="300px" height="400px" />
<p class="caption">
Figure 1: Original Sankey Diagram (Source: Wikipedia)
</p>
</div>
<p>Another famous example was created by Charles Minard almost 30 years earlier. Minard’s diagram shows the movement of Napoleon’s army during his 1812 Russian campaign. In the visualization, the width of the arrow becomes thinner as casualties and desertions diminishes the size of Napoleon’s army.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-4"></span>
<img src="/img/Minard.png" alt="Sankey Diagram of Napoleon's Russian Campaign (Source: Wikipedia)"  />
<p class="caption">
Figure 2: Sankey Diagram of Napoleon’s Russian Campaign (Source: Wikipedia)
</p>
</div>
</div>
<div id="getting-the-data-in-shape" class="section level1">
<h1>Getting the Data in Shape</h1>
<p>To create our own Sankey diagram, we decided to use <a href="https://flourish.studio/">Flourish Studio</a>. Flourish offers a variety of visualizations. Flourish actually offers three types of Sankey diagrams: default, multi-step alluvial, and multi-step Sankey. We chose the multi-step alluvial Sankey because each flow is measured at the same time points, i.e. each wave of the survey.</p>
<p>Before uploading our dataset, we needed to structure it to fit Flourish’s specifications. This is where R comes in handy. The Sankey Diagram dataset should have the following five columns.</p>
<div id="dataset-columns" class="section level4">
<h4>Dataset Columns</h4>
<ul>
<li>
<strong>Column A:</strong> Represents the source of the flow.
</li>
<li>
<strong>Column B:</strong> Represents the target of the flow.
</li>
<li>
<strong>Column C:</strong> Represents the Value, which could be the number or proportion of units flowing from the source to the destination at a given point in time .
</li>
<li>
<strong>ColumnD:</strong> Represents the Step From. This indicates the time point of the Source Column.
</li>
<li>
<strong>Column E:</strong> Represents the Step To. This indicates the time point of the Target column.
</li>
</ul>
<p>Each row in the dataset represents a unique flow or arrow between two waves of the study. Below is an example of how the data should be structured.</p>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-5.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>In the example table, there were 3,000 non-smokers in wave 1 (Rows 1 and 2). Of these 3,000 non-smokers, 2,000 remained non-smokers in wave 2 and 1,000 became Current Established Smokers. In Wave 2, there were 2,200 current established smokers (Rows 7 and 8). Of these participants, 1,800 remained current established smokers in Wave 3 and 400 became former smokers.</p>
<p><strong>Constructing and Loading PATH Dathset</strong></p>
<p>So now it’s time to go back to our path data. I constructed the adult_panel dataset by merging together the first three waves of the study <em>(Note: The fourth wave of the study was not available during the time of my internship)</em>. I also constructed a smoking status variable for each wave based on our five smoking behavior classifications.</p>
<pre class="r"><code>dta_raw &lt;- read.csv(&quot;../../../data/adult_panel.csv&quot;, stringsAsFactors = TRUE) 

dta &lt;- dta_raw %&gt;% 
  dplyr::select(PERSONID, starts_with(&#39;smoking_status_full&#39;)) %&gt;% 
  tidyr::drop_na() 

glimpse(dta)</code></pre>
<pre><code>## Rows: 21,400
## Columns: 4
## $ PERSONID               &lt;fct&gt; P000000004, P000000005, P000000030, P000000074,…
## $ smoking_status_full_w1 &lt;fct&gt; never_smoker, current_exp_smoker, current_exp_s…
## $ smoking_status_full_w2 &lt;fct&gt; never_smoker, current_exp_smoker, current_exp_s…
## $ smoking_status_full_w3 &lt;fct&gt; never_smoker, current_exp_smoker, current_est_s…</code></pre>
<p>I’ve only kept complete cases, i.e. adults who participated in all of the first three waves of the study. I did this for simplicity. However, it’s important to note that to make valid inferences to the actual general population, we would need to adjust these numbers using survey weights contained in the original files. Additionally, the survey weights would allow us to adjust for item non-response and attrition. In the future, I plan to create another diagram that adjusts the proportions by the survey weights. In the meantime, this Sankey diagram will help give us a rough estimate of smoking transition over time and allow us to demonstrate the steps needed to construct a Sankey Diagram on Flourish Studio</p>
<p><strong>Transposing Data</strong></p>
<p>Now that we’ve loaded the data into R, we need to transpose the dataset into a “long” format. In the long-form dataset, each row should represent respondent’s smoking status in a particular year. We can use the pivot_longer() from the tidyverse library. By setting the cols parameter to “- PERSONID”, pivot all the columns to a long format except the PERSONID column. Now the “name” column represents the original variable name and the value represents the status for each of thos variables. Notice that the first three columns represents the smoking status of respondent “P000000004” across the first three waves of the study. We can observe that this person reported being a “never smoker” throughout the study.</p>
<pre class="r"><code>dta_long &lt;- dta %&gt;%  
              tidyr::pivot_longer(cols = - PERSONID) 
dta_long %&gt;%  head</code></pre>
<pre><code>## # A tibble: 6 x 3
##   PERSONID   name                   value             
##   &lt;fct&gt;      &lt;chr&gt;                  &lt;fct&gt;             
## 1 P000000004 smoking_status_full_w1 never_smoker      
## 2 P000000004 smoking_status_full_w2 never_smoker      
## 3 P000000004 smoking_status_full_w3 never_smoker      
## 4 P000000005 smoking_status_full_w1 current_exp_smoker
## 5 P000000005 smoking_status_full_w2 current_exp_smoker
## 6 P000000005 smoking_status_full_w3 current_exp_smoker</code></pre>
<p>Next we need to convert the “name” column into an integer. I ucan se the string subset command to extract the wave number from the “name” column. Finally, we can delete the original name column because I know all the data in the “value” column refers to smoking statuses.</p>
<pre class="r"><code>dta_long &lt;- dta_long %&gt;% 
              dplyr::mutate(wave = as.integer(str_sub(name, -1))) %&gt;% 
              dplyr::select(-name)

dta_long %&gt;%  head</code></pre>
<pre><code>## # A tibble: 6 x 3
##   PERSONID   value               wave
##   &lt;fct&gt;      &lt;fct&gt;              &lt;int&gt;
## 1 P000000004 never_smoker           1
## 2 P000000004 never_smoker           2
## 3 P000000004 never_smoker           3
## 4 P000000005 current_exp_smoker     1
## 5 P000000005 current_exp_smoker     2
## 6 P000000005 current_exp_smoker     3</code></pre>
<p><strong>Source Data Subset</strong>
The next step is to create to separate datasets: one for the source and one for the target. I can create the source dataset by dropping the latest wave. I then rename the value variable to “source” wave variable to “step_from”. The rows in this dataset represent a particular state in the dataset from which we will “step” to another stage. For that reason, we need to exclude the latest wave of data because we don’t have any other stage to advance to from.</p>
<pre class="r"><code>#drop the last wave
dta_source &lt;- dta_long %&gt;% 
                dplyr::filter(wave != max(wave)) %&gt;% 
                rename(source = value,
                       step_from = wave)
dta_source %&gt;%  head</code></pre>
<pre><code>## # A tibble: 6 x 3
##   PERSONID   source             step_from
##   &lt;fct&gt;      &lt;fct&gt;                  &lt;int&gt;
## 1 P000000004 never_smoker               1
## 2 P000000004 never_smoker               2
## 3 P000000005 current_exp_smoker         1
## 4 P000000005 current_exp_smoker         2
## 5 P000000030 current_exp_smoker         1
## 6 P000000030 current_exp_smoker         2</code></pre>
<p><strong>Destination Dataset</strong></p>
<p>Next I create a “destination” dataset, which is basically the next stage to which we will advance. We can create this dataset by dropping the first wave from the dataset.</p>
<pre class="r"><code>#Drop first wave
dta_dest &lt;- dta_long %&gt;% 
              dplyr::filter(wave != 1) %&gt;% 
              rename(dest = value,
                     step_to = wave)

dta_dest %&gt;%  head</code></pre>
<pre><code>## # A tibble: 6 x 3
##   PERSONID   dest               step_to
##   &lt;fct&gt;      &lt;fct&gt;                &lt;int&gt;
## 1 P000000004 never_smoker             2
## 2 P000000004 never_smoker             3
## 3 P000000005 current_exp_smoker       2
## 4 P000000005 current_exp_smoker       3
## 5 P000000030 current_exp_smoker       2
## 6 P000000030 current_est_smoker       3</code></pre>
<p><strong>Merging the Datasets</strong>
Now we can merge the destination and source datasets by PERSONID. We can use the logical expresion “step_to - step_from == 1” to ensure that each row represents a transition across <em>consecutive</em> waves. We want the transitions between waves 1 and 2 and waves 2 and 3, but we want to exclude the transitions between waves 1 and 3.</p>
<pre class="r"><code>dta_sankey &lt;- dta_source %&gt;% 
                inner_join(dta_dest, by = &#39;PERSONID&#39;) %&gt;% 
                dplyr::select(PERSONID, source, dest, step_from, step_to) %&gt;%   
                filter(step_to - step_from== 1)

dta_sankey %&gt;%  head</code></pre>
<pre><code>## # A tibble: 6 x 5
##   PERSONID   source             dest               step_from step_to
##   &lt;fct&gt;      &lt;fct&gt;              &lt;fct&gt;                  &lt;int&gt;   &lt;int&gt;
## 1 P000000004 never_smoker       never_smoker               1       2
## 2 P000000004 never_smoker       never_smoker               2       3
## 3 P000000005 current_exp_smoker current_exp_smoker         1       2
## 4 P000000005 current_exp_smoker current_exp_smoker         2       3
## 5 P000000030 current_exp_smoker current_exp_smoker         1       2
## 6 P000000030 current_exp_smoker current_est_smoker         2       3</code></pre>
<p><strong>Examples of Transitions</strong>
Here we can see six respondents who never smoked at wave 1 but became current established smokers by wave 2.</p>
<pre class="r"><code>dta_sankey %&gt;%  
  filter(source ==&#39;never_smoker&#39; &amp; dest == &#39;current_est_smoker&#39; &amp; step_from == 1  &amp; step_to ==2)  %&gt;% 
  head</code></pre>
<pre><code>## # A tibble: 6 x 5
##   PERSONID   source       dest               step_from step_to
##   &lt;fct&gt;      &lt;fct&gt;        &lt;fct&gt;                  &lt;int&gt;   &lt;int&gt;
## 1 P000009116 never_smoker current_est_smoker         1       2
## 2 P000084125 never_smoker current_est_smoker         1       2
## 3 P000124077 never_smoker current_est_smoker         1       2
## 4 P000147567 never_smoker current_est_smoker         1       2
## 5 P000162806 never_smoker current_est_smoker         1       2
## 6 P000177195 never_smoker current_est_smoker         1       2</code></pre>
<p>Here we can see six respondents who were current established smokers at wave 2 but became former smokers by wave 3.</p>
<pre class="r"><code>dta_sankey %&gt;%  
  filter(source ==&#39;current_est_smoker&#39; &amp; dest == &#39;former_est_smoker&#39; &amp; 
           step_from == 2  &amp; step_to ==3)  %&gt;% 
  head</code></pre>
<pre><code>## # A tibble: 6 x 5
##   PERSONID   source             dest              step_from step_to
##   &lt;fct&gt;      &lt;fct&gt;              &lt;fct&gt;                 &lt;int&gt;   &lt;int&gt;
## 1 P000001441 current_est_smoker former_est_smoker         2       3
## 2 P000001710 current_est_smoker former_est_smoker         2       3
## 3 P000002507 current_est_smoker former_est_smoker         2       3
## 4 P000002531 current_est_smoker former_est_smoker         2       3
## 5 P000003118 current_est_smoker former_est_smoker         2       3
## 6 P000003641 current_est_smoker former_est_smoker         2       3</code></pre>
<p>Note that some smoking transitions are impossible. For example, no established or experimental smoker can become a never smoker again.</p>
<pre class="r"><code>dta_sankey %&gt;%  
  filter(source %in% c(&#39;current_est_smoker&#39;, 
                       &#39;former_est_smoker&#39;, 
                       &#39;current_exp_smoker&#39;, 
                       &#39;former_exp_smoker&#39;),
         dest == &#39;never_smoker&#39;) </code></pre>
<pre><code>## # A tibble: 0 x 5
## # … with 5 variables: PERSONID &lt;fct&gt;, source &lt;fct&gt;, dest &lt;fct&gt;,
## #   step_from &lt;int&gt;, step_to &lt;int&gt;</code></pre>
<p>Furthermore, established smokers can never become experimental smokers again. Once you’ve passed the 100-cigarette threshold, there’s no way to go back.</p>
<pre class="r"><code>dta_sankey %&gt;%  
  filter(source %in% c(&#39;current_est_smoker&#39;, &#39;former_est_smoker&#39;),
         dest == c(&#39;current_exp_smoker&#39;, &#39;former_exp_smoker&#39;) )</code></pre>
<pre><code>## # A tibble: 0 x 5
## # … with 5 variables: PERSONID &lt;fct&gt;, source &lt;fct&gt;, dest &lt;fct&gt;,
## #   step_from &lt;int&gt;, step_to &lt;int&gt;</code></pre>
<p>However, never smokers can become experiment smokers and experimental smokers can become established.</p>
<pre class="r"><code>dta_sankey %&gt;% 
  filter(source == &#39;current_exp_smoker&#39;, dest == &#39;current_est_smoker&#39;) %&gt;% 
  head</code></pre>
<pre><code>## # A tibble: 6 x 5
##   PERSONID   source             dest               step_from step_to
##   &lt;fct&gt;      &lt;fct&gt;              &lt;fct&gt;                  &lt;int&gt;   &lt;int&gt;
## 1 P000000030 current_exp_smoker current_est_smoker         2       3
## 2 P000000176 current_exp_smoker current_est_smoker         1       2
## 3 P000001971 current_exp_smoker current_est_smoker         1       2
## 4 P000002269 current_exp_smoker current_est_smoker         1       2
## 5 P000002507 current_exp_smoker current_est_smoker         1       2
## 6 P000002849 current_exp_smoker current_est_smoker         1       2</code></pre>
<p>In addition, you can transition back and forth between being a former smoker and current smoker.</p>
<pre class="r"><code>dta_sankey %&gt;% 
  filter(str_detect(source, &#39;est_smoker$&#39;), str_detect(dest, &#39;est_smoker$&#39;), source != dest) %&gt;% 
  head()</code></pre>
<pre><code>## # A tibble: 6 x 5
##   PERSONID   source             dest               step_from step_to
##   &lt;fct&gt;      &lt;fct&gt;              &lt;fct&gt;                  &lt;int&gt;   &lt;int&gt;
## 1 P000000225 current_est_smoker former_est_smoker          1       2
## 2 P000000470 current_est_smoker former_est_smoker          1       2
## 3 P000001054 former_est_smoker  current_est_smoker         1       2
## 4 P000001142 current_est_smoker former_est_smoker          1       2
## 5 P000001142 former_est_smoker  current_est_smoker         2       3
## 6 P000001371 current_est_smoker former_est_smoker          1       2</code></pre>
<p><strong>Grouping and Summarizing the Data</strong>
The final step before uploading the data is aggregate the data. The dataset should not be individual-level dataset but at the level of each transition type. I’ve also pasted “Wave” in front of the step_to and step_from variables. This will make our headings clearer when we create our Sankey Diagram.</p>
<pre class="r"><code>dta_sankey_cnt &lt;-dta_sankey %&gt;% 
                    group_by(source,dest, step_from, step_to) %&gt;% 
                    summarize(value =n(), .groups = &quot;rowwise&quot;) %&gt;% 
                    dplyr::select(source, dest, value, step_from, step_to)
              

sankey_tab &lt;- dta_sankey_cnt %&gt;% 
  arrange(step_from, step_to) %&gt;% 
  DT::datatable() 

widgetframe::frameWidget(sankey_tab )</code></pre>
<div id="htmlwidget-2" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"url":"index_files/figure-html//widgets/widget_unnamed-chunk-17.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>Note here that there are 34 rows. Each row represents a transition between two smoking states across two consequent waves. The number in the value column indicates the number of respondents. For example, there were 889 respondents who went from being “current established smokers” to “former established smokers” from wave 1 to wave 2 (indicated by the step_to and step_from columns). Notice also that the source can be equal to the destination for respondents who remained in the same smoking state across two consecutive waves of the study. In fact, we’ll see from the sankey plot, that this is the most likely scenario for respondents in our study!.</p>
</div>
</div>
<div id="exporting-and-uploading-data-to-flourish-studio" class="section level1">
<h1>Exporting and Uploading Data to Flourish Studio</h1>
<p>First we can use export the data as a csv file.</p>
<pre class="r"><code>write_csv(dta_sankey_cnt, &quot;../../../data/path_sankey.csv&quot;)</code></pre>
<p>Next we can log on to our Flourish studio account and click the muti-stage alluvial plot under the Sankey Diagram visualiztion. In the next agep, click the data button above the diagram. Then click the "Upload Data’ on the right. Finally, select the file containing your data.</p>
<p>If you arranged the dataset in ordre (Source, Tareget, Value, Step From, Step to), Flourish should automatically recognize. You can use the control panel in the sidebar to make any necessary corrections. If everything looks okay, click the “preview” button.</p>
<p>And voila, we now have a Sankey plot!</p>
<div class="flourish-embed flourish-sankey" data-src="visualisation/6249967">
<script src="https://public.flourish.studio/resources/embed.js"></script>
</div>
<p>We can give our Sankey plot a name by clicking on the top of the page. Finally, we can click “Export &amp; publish” on the upper right. You have the options of downloading your diagram or publishing it. Only publish your diagram if you’re sure that the diagram does not contain any sensitive infomration (Note: that there is an option to require a password but this is only available with Flourish’s paid business account).</p>
<div id="use-our-sankey-diagram-to-explore-cigarette-use-over-time" class="section level2">
<h2>Use our Sankey Diagram to Explore Cigarette-Use over Time</h2>
<p>The first thing I noticed was that the thickest line from each state flows the same state in the next wave. Your most likely state in the next wave of the study is your state in the current wave of the study.</p>
<p>Another thing that I noticed was that the “never smokers” line seems to be the most consistent. Never smokers in wave 1 tended to stay never smokers in waves 2 and 3. This probably reflects the fact that all respondents were over the age of 18 during the first wave of the study. Adults who are never smokers do not tend to take up smoking later in life. For this reason, it would also be interesting to explore the Youth survey to investigate how respondents under the age of 18 started to experiment with cigarette stating.</p>
<p>Another thing I thought would be interesting is to explore relapse rates among former established smokers over time. From wave 1 to wave 2 about 12% (432 out 3,607) of former established smokers relapsed. About the same proportion (12.4% or 521 out of 4,437 to be exact) relapsed between waves 2 and 3. We could use multi-state to investigate the over risk of relapse at a given wave.</p>
</div>
</div>
<div id="appendix" class="section level1">
<h1>Appendix</h1>
<div id="original-datasets" class="section level2">
<h2>Original Datasets</h2>
<p>You can download the public-use datasets <a href="https://www.icpsr.umich.edu/web/NAHDAP/studies/36498">here</a>.</p>
<p>The files DS1001, DS2001, DS3001, and DS4001 correspond to waves 1 through 4 of the adult survey.</p>
<p>Once you download these datasets you can merge them by the variable PERSONID. This creates a “wide” dataset in which each column contained a particular variable from a single wave. In my <em>adult_panel</em> dataset, I added a suffixes (w1, w2, w3) indicating which wave each variable comes from.The original variable names include the prefix R01, R02, R03, and R04 where “R” refers to the adult survey and the numbers refer to the particular wave.</p>
<div id="original-variables" class="section level4">
<h4>Original Variables</h4>
<p>The dataset includes the original questions used to derive each smoking category as well as series of derived indicator variables for each category.
1. R01R_A_CUR_ESTD_CIGS: Wave 1 Current Established Smokers
2. R01R_A_CUR_EXPR_CIGS: Wave 1 Current Experimental Smokers
3. R01R_A_FMR_ESTD_CIGS: Wave 1 Former Established Smokers
4. R01R_A_FMR_EXPR_CIGS: Wave 1 Former Experimental Smokers</p>
<p>The variables in the other datasets have the same name with the number after the initial “R” representing the wave of the study. The only other differncee is that the wave 2 and wave 3 “former” smoker categories have a "_REV" suffix, e.g. R02R_A_FMR_ESTD_CIGS_REV represents wave 2 former established smokers.</p>
<p>To find wave 1 never smokers, you can use the variable R01R_A_NVR_CIGS. To find never smokers in waves 2 and 3, you can use the completment of R02R_A_EVR_CIGS and R03R_A_EVR_CIGS.</p>
<p>The dataset also includes indicators for whether a person was “continuing adult” in a given wave of the study. However, we can use a inner join to constrain our sample to include only adults from wave 1 who responded in each subsequent wave.</p>
</div>
</div>
<div id="survey-weighting" class="section level2">
<h2>Survey Weighting</h2>
<p>Finally, the survey actually has a series of weights to adjust for both attrition and non-representativeness of the sample. The weights take into account several factors.</p>
<ol style="list-style-type: decimal">
<li>The complex sampling design. As in most surveys, the PATH study used both stratification and clustering sampling methods instead of simple random sampling.<br />
</li>
<li>Intentional oversampling. The PATH survey intentionally over samples people between the ages of 18 and 34, African-American adults, and
3.Non-response bias. The characteristics of respondents may not reflect the population because not everyone</li>
<li>Attrition between waves</li>
</ol>
<p>You can learn more about the survey weighting process <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5299069/">here</a>.</p>
<div id="multi-state-modeling" class="section level3">
<h3>Multi-state Modeling</h3>
<p>Multi-state modeling is a good tool for estimating the probability of transitioning<a href="https://cran.r-project.org/web/packages/survival/vignettes/compete.pdf%5D">Therneau, Crowson, &amp; Atkinson, 2021</a>. Multi-state modeling is essentially a generalization of survival analysis (ibid). In survival analysis there only two stages, life and death, and you can only transition from the first state to the second. However, in multi-state modeling there can be more than two states and it can be possible to revert. For example, if we focus cigarette smoking, we can imagine the five states that we used for our Sankey diagram. In this model, it would be possible to transition back and forth between some states such as between current established smoker and former established smoker. The major assumption is that the the</p>
<p><strong>Example of Transition Matrix</strong></p>
<pre class="r"><code>mat &lt;- matrix(c(&#39;p11&#39;, &#39;p12&#39;, &#39;p13&#39;, &#39;p21&#39;, &#39;p22&#39;, &#39;p23&#39;, &#39;0&#39;, &#39;0&#39;, &#39;p33&#39;), ncol=3)
rownames(mat) &lt;- c(&#39;Current Smoker&#39;, &#39;Former Smoker&#39;, &#39;Never Smoker&#39;)
colnames(mat)  &lt;- c(&#39;Current Smoker&#39;, &#39;Former Smoker&#39;, &#39;Never Smoker&#39;)
mat</code></pre>
<pre><code>##                Current Smoker Former Smoker Never Smoker
## Current Smoker &quot;p11&quot;          &quot;p21&quot;         &quot;0&quot;         
## Former Smoker  &quot;p12&quot;          &quot;p22&quot;         &quot;0&quot;         
## Never Smoker   &quot;p13&quot;          &quot;p23&quot;         &quot;p33&quot;</code></pre>
<p><em>Example of Transition Matrix</em></p>
<p>The row names represent the state in a wave (<em>t</em>) and the column names represent the state in the next wave (<em>t+1</em>). I’ve removed the established vs. experimental distinction in order to simplify the matrix. Each element within represents the probability of transitioning from one state to the next between two waves of the study. For example, p21 represents the probability of a current smoker becoming a former smoker from time <em>t</em> to time <em>t + 1</em>. Notice that the first two rows in the third column are equal to zero because current and former smokers cannot become never smokers again.</p>
<p>Although this example would be an example of discrete-time, multi-state models can also be used in continuous cases. Also the most common assumptions is these models are that transition probabilities only depend on the current state <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2692556/#:~:text=The%20analysis%20in%20such%20studies,a%20finite%20number%20of%20states.&amp;text=A%20change%20of%20state%20is%20called%20a%20transition%2C%20or%20an%20event">Meira-Machado et. al, 2009</a>.</p>
</div>
</div>
<div id="next-steps" class="section level2">
<h2>Next Steps</h2>
<p>I additional ideas of things to do with the PATH data. Some of these would be building on the work that I already did during my internship and other ones would be charting new territory.</p>
<ol style="list-style-type: decimal">
<li>Add wave 4 data</li>
<li>Create another Sankey Plot using survey weights</li>
<li>Create a tutorial about how to use the surveyR package with PATH data</li>
<li>Fit a multinomial logistic regression to explore smoking transitions across two waves of the study</li>
<li>Use multi-state modeling to investigate probabilities of smoking transitional states across multiple waves</li>
</ol>
</div>
</div>
